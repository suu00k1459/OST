{% extends 'base.html' %} {% block content %}
<div class="container mt-5">
    <!-- Hero Section -->
    <div class="fl-hero mb-5">
        <h1 class="display-6 fw-bold mb-2">Device Network</h1>
        <p class="lead text-muted">
            {% if not no_data %} Monitoring
            <strong>{{ total }}</strong> federated device(s) {% else %} No
            devices detected {% endif %}
        </p>
        {% if not no_data %}
        <hr class="my-4" />
        <div class="row g-3 mb-4">
            <div class="col-md-4">
                <div class="fl-stat-card">
                    <div class="fl-stat-number">{{ total }}</div>
                    <div class="fl-stat-label">Total Devices</div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="fl-stat-card">
                    <div class="fl-stat-number">{{ total_pages }}</div>
                    <div class="fl-stat-label">Pages</div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="fl-stat-card">
                    <div class="fl-stat-number">
                        {{ page }}/{{ total_pages }}
                    </div>
                    <div class="fl-stat-label">Current Page</div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- No Data State -->
    {% if no_data %}
    <div class="alert alert-warning alert-lg border-0 shadow-sm">
        <div class="d-flex align-items-center">
            <i class="fas fa-exclamation-triangle fa-2x me-3 text-warning"></i>
            <div>
                <h5 class="alert-heading mb-2">
                    Data Source Not Processed Yet
                </h5>
                <p class="mb-0">
                    Please run the <strong>preprocessing notebook</strong> to
                    generate CSV files in the
                    <code>data/processed</code> directory.
                </p>
                <small class="text-muted"
                    >Look for "Data PreProcessing.ipynb" in the
                    <code>notebooks/</code> folder.</small
                >
            </div>
        </div>
    </div>
    {% else %}

    <!-- Device Cards Grid -->
    <div class="row g-4 mb-5">
        {% for d in devices %}
        <div class="col-lg-4 col-md-6">
            <a href="{{ d.preview_url }}" class="text-decoration-none">
                <div class="fl-device-card">
                    <div class="fl-device-header">
                        <i class="fas fa-microchip"></i>
                        <span class="fl-device-name"
                            >{{ d.name | replace('.csv', '') }}</span
                        >
                    </div>
                    <div class="fl-device-body">
                        <div class="fl-stat-row">
                            <span class="fl-stat-label">Rows</span>
                            <span class="fl-stat-value"
                                >{{ d.stats.rows }}</span
                            >
                        </div>
                        <div class="fl-stat-row">
                            <span class="fl-stat-label">Columns</span>
                            <span class="fl-stat-value"
                                >{{ d.stats.cols }}</span
                            >
                        </div>
                        <div class="fl-stat-row">
                            <span class="fl-stat-label">Size</span>
                            <span class="fl-stat-value"
                                >{{ d.stats.size_kb }} KB</span
                            >
                        </div>
                        <div class="fl-stat-row">
                            <span class="fl-stat-label">Modified</span>
                            <span class="fl-stat-value small"
                                >{{ d.stats.modified }}</span
                            >
                        </div>
                    </div>
                    <div class="fl-device-footer">
                        <span class="fl-btn-text">View Details â†’</span>
                    </div>
                </div>
            </a>
        </div>
        {% endfor %}
    </div>

    <!-- Pagination -->
    {% if total_pages > 1 %}
    <nav aria-label="Device pagination" class="d-flex justify-content-center">
        <ul class="pagination pagination-lg">
            <li class="page-item {% if page <= 1 %}disabled{% endif %}">
                <a
                    class="page-link"
                    href="?page=1&per_page={{ per_page }}"
                    aria-label="First"
                >
                    <i class="fas fa-chevron-left"></i>
                </a>
            </li>

            {% set start_page = [1, page - 2] | max %} {% set end_page =
            [total_pages, page + 2] | min %} {% if start_page > 1 %}
            <li class="page-item disabled">
                <span class="page-link">...</span>
            </li>
            {% endif %} {% for p in range(start_page, end_page + 1) %}
            <li class="page-item {% if p == page %}active{% endif %}">
                <a
                    class="page-link"
                    href="?page={{ p }}&per_page={{ per_page }}"
                    >{{ p }}</a
                >
            </li>
            {% endfor %} {% if end_page < total_pages %}
            <li class="page-item disabled">
                <span class="page-link">...</span>
            </li>
            {% endif %}

            <li
                class="page-item {% if page >= total_pages %}disabled{% endif %}"
            >
                <a
                    class="page-link"
                    href="?page={{ total_pages }}&per_page={{ per_page }}"
                    aria-label="Last"
                >
                    <i class="fas fa-chevron-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    {% endif %} {% endif %}
</div>
{% endblock %}
