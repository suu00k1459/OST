FROM apache/spark:3.5.0

# Switch to root to install packages
USER root

# Install Python packages needed for analytics
RUN pip3 install --no-cache-dir kafka-python psycopg2-binary scikit-learn

# Create work directory with proper permissions
RUN mkdir -p /opt/spark/work && chown -R spark:spark /opt/spark/work && chmod 777 /opt/spark/work

# Switch back to spark user
USER spark

# Use the standard entry point
