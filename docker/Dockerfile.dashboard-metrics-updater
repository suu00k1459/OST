FROM python:3.11-slim

WORKDIR /app

ENV PYTHONDONTWRITEBYTECODE=1 \
    PYTHONUNBUFFERED=1 \
    PIP_DEFAULT_TIMEOUT=300 \
    PIP_DISABLE_PIP_VERSION_CHECK=1 \
    PIP_NO_CACHE_DIR=1

# Use global requirements as constraints
COPY requirements.txt .

RUN pip install --prefer-binary --retries 5 --constraint requirements.txt \
    psycopg2-binary \
    python-dotenv

# Scripts (includes dashboard_metrics_updater.py + optional config_loader)
COPY scripts/ /app/scripts/

# Default DB envs â€“ docker-compose can override
ENV DB_HOST=timescaledb \
    DB_PORT=5432 \
    DB_NAME=flead \
    DB_USER=flead \
    DB_PASSWORD=password

CMD ["python", "scripts/dashboard_metrics_updater.py"]
