#!/usr/bin/env bash
# ============================================================================
# FLEAD Platform Shutdown Script (Linux/macOS/WSL)
# Stops all Docker services and cleans up containers
# Usage: ./stop
# ============================================================================
set -e

# Go to repo root (directory of this script)
cd "$(dirname "$0")"

echo
echo "==================================================="
echo "FEDERATED LEARNING PLATFORM - SHUTDOWN (POSIX)"
echo "==================================================="
echo

echo "Stopping all services..."
if docker compose version >/dev/null 2>&1; then
  docker compose down -v --remove-orphans
elif command -v docker-compose >/dev/null 2>&1; then
  docker-compose down -v --remove-orphans
else
  echo "[WARNING] Docker Compose not found, trying docker stop..."
  docker stop $(docker ps -q) 2>/dev/null || true
fi
echo "Done."
echo

echo "Cleaning up stopped Docker containers..."
docker container prune -f >/dev/null 2>&1 || true
echo "Done."
echo

echo "==================================================="
echo "SHUTDOWN COMPLETE (POSIX)"
echo "==================================================="
echo "To start again: ./start"
echo
